spring:
  application:
    name: compliance-sync-service-test
  # Test Database Configuration - File-based H2 database for easier inspection
  datasource:
    # Store in build directory - gets cleaned automatically and ignored by Git
    # Removed DB_CLOSE_DELAY and DB_CLOSE_ON_EXIT (incompatible with file mode)
    # Added MODE=LEGACY for Hibernate compatibility
    url: jdbc:h2:file:./build/data/test_compliance_state_db;AUTO_SERVER=TRUE;MODE=LEGACY
    driverClassName: org.h2.Driver
    username: sa
    password:
  jpa:
    database-platform: org.hibernate.dialect.H2Dialect
    hibernate:
      ddl-auto: create-drop # Creates schema on startup, drops on shutdown
    show-sql: false # Reduce test noise
  # Enable H2 Console for development/testing
  h2:
    console:
      enabled: true
      path: /h2-console
  # Kafka Configuration - Disabled for tests since we use @MockitoBean
  kafka:
    bootstrap-servers: embedded # Use embedded for tests to avoid connection attempts
    consumer:
      group-id: compliance-sync-test-group
      auto-offset-reset: earliest
      enable-auto-commit: false
    producer:
      key-serializer: org.apache.kafka.common.serialization.StringSerializer
      value-serializer: org.springframework.kafka.support.serializer.JsonSerializer

# Custom Application Properties for Tests
app:
  kafka:
    topics:
      ad-changes: ad-user-changes-test-topic
      crt-changes: crt-team-changes-test-topic
      dlt: compliance-sync-test.dlt
  reconciliation:
    cron: "-" # Disable scheduled reconciliation in tests

# Logging configuration for tests
logging:
  level:
    com.edwardjones.cre: DEBUG
    org.springframework.kafka: WARN
    org.apache.kafka: WARN
